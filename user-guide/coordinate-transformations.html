
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Coordinate Transformations &#8212; ScippNeutron</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css?v=a0a71c94" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=5db94ae7"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/coordinate-transformations';</script>
    <script src="../_static/anaconda-icon.js?v=461bdc62"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GroupBy" href="groupby.html" />
    <link rel="prev" title="Chopper Cascades" href="chopper/chopper-cascade.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.0.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="ScippNeutron - Home"/>
    <img src="../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="ScippNeutron - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io">
    Scipp
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/scippnexus">
    ScippNexus
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/scippneutron" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/scippneutron/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/scippneutron" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io">
    Scipp
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/scippnexus">
    ScippNexus
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/scippneutron" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/scippneutron/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/scippneutron" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="chopper/index.html">Choppers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="chopper/processing-nexus-choppers.html">Reading and processing NeXus choppers</a></li>
<li class="toctree-l2"><a class="reference internal" href="chopper/chopper-cascade.html">Chopper Cascades</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Coordinate Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">GroupBy</a></li>
<li class="toctree-l1"><a class="reference internal" href="from-mantid-to-scipp.html">From Mantid to Scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrument-view.html">Instrument view</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes: How do I …?</a></li>
<li class="toctree-l1"><a class="reference internal" href="masking-tool.html">Interactive masking tool</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="algorithms-background/index.html">Background on algorithms</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="algorithms-background/two_theta-gravity-correction.html">two_theta gravity correction</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="absorption-correction.html">Absorption correction example</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#About-coordinate-transformations">About coordinate transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Built-in-transformations">Built-in transformations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Overview-of-time-of-flight-transformations">Overview of time-of-flight transformations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Transformation-graphs">Transformation graphs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Performing-a-coordinate-transformation">Performing a coordinate transformation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Customizing-transformations">Customizing transformations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Gravity-correction">Gravity correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Plane-wave-beam">Plane wave beam</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Diffraction-calibration">Diffraction calibration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#2-D-Rietveld">2-D Rietveld</a></li>
</ul>
</li>
</ul>
  </nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/user-guide/coordinate-transformations.ipynb">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Coordinate Transformations</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Coordinate-Transformations">
<h1>Coordinate Transformations<a class="headerlink" href="#Coordinate-Transformations" title="Link to this heading">#</a></h1>
<section id="About-coordinate-transformations">
<h2>About coordinate transformations<a class="headerlink" href="#About-coordinate-transformations" title="Link to this heading">#</a></h2>
<p>There are a number of essential coordinate transformations specific to neutron-scattering such as conversion from time-of-flight to <span class="math notranslate nohighlight">\(\lambda\)</span> (wavelength) or <span class="math notranslate nohighlight">\(Q\)</span> (momentum transfer). Such coordinate transformations are also frequently referred to as “unit conversion”, but here we avoid this terminology, to clearly distinguish from <a class="reference external" href="https://scipp.github.io/generated/functions/scipp.to_unit.html#scipp.to_unit">conversion of array units using</a> <code class="docutils literal notranslate"><span class="pre">sc.to_unit</span></code>.</p>
<p>Scipp provides <a class="reference external" href="https://scipp.github.io/user-guide/coordinate-transformations.html">coordinate transformations using</a> <code class="docutils literal notranslate"><span class="pre">sc.transform_coords</span></code>. Scippneutron defines concrete transformations for time-of-flight neutron scattering, as well as building blocks for customizing transformations. Both are discussed in the following.</p>
</section>
<section id="Built-in-transformations">
<h2>Built-in transformations<a class="headerlink" href="#Built-in-transformations" title="Link to this heading">#</a></h2>
<section id="Overview-of-time-of-flight-transformations">
<h3>Overview of time-of-flight transformations<a class="headerlink" href="#Overview-of-time-of-flight-transformations" title="Link to this heading">#</a></h3>
<p>For background, we refer to PaN-learning on <a class="reference external" href="https://e-learning.pan-training.eu/wiki/index.php/Introduction_to_neutron_scattering">Introduction to neutron scattering</a> and <a class="reference external" href="https://e-learning.pan-training.eu/wiki/index.php/Basics_of_neutron_scattering">Basics of neutron scattering</a>. Below we also describe the more direct approach.</p>
<p>We define the beamline geometry as in this image:</p>
<p><img alt="image" src="../_images/beamline_coordinates_light1.svg" /></p>
<p>Where the source position defines the point where <span class="math notranslate nohighlight">\(t=0\)</span> (or vice versa). And <span class="math notranslate nohighlight">\(2\theta\)</span> is the scattering angle, as defined in Bragg’s law, not to be confused with <span class="math notranslate nohighlight">\(\theta_{\mathsf{spherical}}\)</span> in spherical coordinates. In many instruments the beam is roughly aligned with the <span class="math notranslate nohighlight">\(z\)</span>-axis, so <span class="math notranslate nohighlight">\(2\theta = \theta_{\mathsf{spherical}}\)</span>. The factor of <span class="math notranslate nohighlight">\(2\)</span> is a recurrent source of bugs.</p>
<p>In addition:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(h\)</span> is the Planck constant, <span class="math notranslate nohighlight">\(m_{\mathsf{n}}\)</span> is the neutron mass.</p></li>
<li><p><span class="math notranslate nohighlight">\(d\)</span> is the interplanar lattice spacing</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span> is the de Broglie wavelength</p></li>
<li><p><span class="math notranslate nohighlight">\(\vec{Q}\)</span> (<code class="docutils literal notranslate"><span class="pre">Q_vec</span></code> in code) is the momentum transfer and <span class="math notranslate nohighlight">\(Q\)</span> its norm</p></li>
<li><p><span class="math notranslate nohighlight">\(E\)</span> is the energy</p></li>
</ul>
<p>In the special case of inelastic neutron scattering we have additionally:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E_i\)</span> is the known incident energy. This case is called <em>direct inelastic scattering</em>. We define <span class="math notranslate nohighlight">\(t_0 = \sqrt{L_1^2 \cdot m_{\mathsf{n}} / (2 E_i)}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(E_f\)</span> is the known final energy. This case is called <em>indirect inelastic scattering</em>. We define <span class="math notranslate nohighlight">\(t_0 = \sqrt{L_2^2 \cdot m_{\mathsf{n}} / (2 E_f)}\)</span> In this case <span class="math notranslate nohighlight">\(E_f\)</span> is actually determined by analyzer crystals in the secondary flight path. It is assumed that the detector positions are set to the effective (neutronic) rather than physical positions, since the computation of <span class="math notranslate nohighlight">\(L_2\)</span> assumes a straight line connection between sample and detectors.</p></li>
</ul>
<p>Conversions between these quantities are given by the following table:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input coord</p></th>
<th class="head"><p>Output coord</p></th>
<th class="head"><p>Equation used for coord transformation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tof</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dspacing</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(d = \frac{\lambda}{2\sin(\theta)} = \frac{h \cdot t}{L_{\mathsf{total}} \cdot m_{\mathsf{n}} \cdot 2 \sin(\theta)}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tof</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wavelength</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\lambda = \frac{h \cdot t}{m_{\mathsf{n}} \cdot L_{\mathsf{total}}}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wavelength</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Q</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(Q = \frac{4 \pi \sin(\theta)}{\lambda}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Q</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wavelength</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\lambda = \frac{4 \pi \sin(\theta)}{Q}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wavelength</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Q_vec</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\vec{Q} = \vec{k}_i - \vec{k}_f = \frac{2\pi}{\lambda} \left(\hat{e}_i - \hat{e}_f\right)\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tof</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(E = \frac{m_{\mathsf{n}}L^2_{\mathsf{total}}}{2t^2}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tof</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_transfer</span></code> (direct)</p></td>
<td><p><span class="math notranslate nohighlight">\(E = E_i - \frac{m_{\mathsf{n}}L^2_{\mathsf{2}}}{2\left(t-t_0\right)^{2}}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tof</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_transfer</span></code> (indirect)</p></td>
<td><p><span class="math notranslate nohighlight">\(E = \frac{m_{\mathsf{n}}L^2_{\mathsf{1}}}{2\left(t-t_0\right)^{2}} - E_f\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>See the reference of <a class="reference internal" href="../generated/modules/scippneutron.conversion.html"><span class="doc">scippneutron.conversion</span></a> for additional conversions and more details.</p>
</section>
<section id="Transformation-graphs">
<h3>Transformation graphs<a class="headerlink" href="#Transformation-graphs" title="Link to this heading">#</a></h3>
<p>The above table defines how an output coordinate such as <code class="docutils literal notranslate"><span class="pre">wavelength</span></code> is computed from inputs such as <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code> and <code class="docutils literal notranslate"><span class="pre">tof</span></code>. In practice not all input data directly comes with all the required metadata. For example, instead of <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code> the metadata may only contain <code class="docutils literal notranslate"><span class="pre">source_position</span></code>, <code class="docutils literal notranslate"><span class="pre">sample_position</span></code>, and <code class="docutils literal notranslate"><span class="pre">position</span></code>. These can then be used to compute derived metadata such as <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code>. <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code> can automatically do this by walking a transformation graph.</p>
<p>The transformations typically require two components:</p>
<ol class="arabic simple">
<li><p>A definition of the beamline geometry which defines, e.g., how scattering angles are to be computed from positions of beamline components such as sample and detector positions.</p></li>
<li><p>A definition of the scattering kinematics and dynamics, e.g., how <span class="math notranslate nohighlight">\(\lambda\)</span> or <span class="math notranslate nohighlight">\(Q\)</span> can be computed from time-of-flight for an elastic scattering process.</p></li>
</ol>
<p>Pre-defined standard components (transformation graphs and graph building blocks) are available in <a class="reference internal" href="../generated/modules/scippneutron.conversion.graph.html"><span class="doc">scippneutron.conversion.graph</span></a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">graph</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">graph.beamline.beamline</span></code> defines a “simple” (straight) time-of-flight beamline with source-, sample-, and detector positions. Two variants, with and without scattering are provided.</p>
<p>Without scattering, the transformation graph is simple. This intended for use with monitors or imaging beamlines where no scattering from a sample occurs:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">beamline</span><span class="o">.</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_3_0.svg" src="../_images/user-guide_coordinate-transformations_3_0.svg" />
</div>
</div>
<p>The graph is to be read as follows. Starting with the node for the desired output coordinate, here <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code>, <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code> proceeds as follows:</p>
<ol class="arabic simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code> is found in the metadata, no transformation is performed. Return <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code> is not found in the metadata,</p>
<ol class="arabic simple">
<li><p>For each input to the node (arrows pointing <em>to</em> the node, here <code class="docutils literal notranslate"><span class="pre">source_position</span></code> and <code class="docutils literal notranslate"><span class="pre">position</span></code>) go to 1., i.e., either find the input, or compute it by continuing to walk upwards in the graph.</p></li>
<li><p>Compute <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code> from the found or computed inputs and return it.</p></li>
</ol>
</li>
</ol>
<p>If the top of the graph is reached without finding all required inputs, the transformation fails. Refer to the scipp documentation on <a class="reference external" href="https://scipp.github.io/user-guide/coordinate-transformations.html">Coordinate Transformations</a> for a more detailed explanation.</p>
<p>A more complex example is <code class="docutils literal notranslate"><span class="pre">conversions.beamline</span></code> for a scattering process:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">beamline</span><span class="o">.</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_5_0.svg" src="../_images/user-guide_coordinate-transformations_5_0.svg" />
</div>
</div>
<p>In addition to defining how beamline parameters can be computed, a second building block defines how, e.g., <span class="math notranslate nohighlight">\(\lambda\)</span> or <span class="math notranslate nohighlight">\(Q\)</span> can be computed from an input coordinate. There are four cases:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">conversions.kinematic</span></code> for straight propagation of neutrons, i.e., without any scattering process. This is intended for use in combination with <code class="docutils literal notranslate"><span class="pre">conversions.beamline(scatter=False)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conversions.elastic</span></code> for elastic scattering processes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conversions.direct_inelastic</span></code> for direct-inelastic scattering processes, i.e., for fixed incident energies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conversions.indirect_inelastic</span></code> for direct-inelastic scattering processes, i.e., fixed final energies, typically using analyzer crystals.</p></li>
</ul>
<p>The coordinate transformation logic defined by these four cases is as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">kinematic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">),</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_7_0.svg" src="../_images/user-guide_coordinate-transformations_7_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">elastic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">),</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_8_0.svg" src="../_images/user-guide_coordinate-transformations_8_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">direct_inelastic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">),</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_9_0.svg" src="../_images/user-guide_coordinate-transformations_9_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">indirect_inelastic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">),</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_10_0.svg" src="../_images/user-guide_coordinate-transformations_10_0.svg" />
</div>
</div>
<p>Computing energy transfer for an indirect geometry instrument requires changes to the <code class="docutils literal notranslate"><span class="pre">beamline</span></code> graph to account for scattering off of the analyzers. This has not yet been implemented in ScippNeutron as the precise input coordinates for relevant instruments are unknown. But an example has been developed for a summer school <a class="reference external" href="https://ess-dmsc-dram.github.io/dmsc-school/4-reduction/reduction-qens.html">here</a>.</p>
</section>
<section id="Performing-a-coordinate-transformation">
<h3>Performing a coordinate transformation<a class="headerlink" href="#Performing-a-coordinate-transformation" title="Link to this heading">#</a></h3>
<p>The transformation graphs depicted above can now be used to transform time-of-flight data to, e.g., <code class="docutils literal notranslate"><span class="pre">wavelength</span></code>. We need to combine the two building blocks, the beamline transformation graph and the elastic scattering transformation graph, into a single graph:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion.graph.beamline</span><span class="w"> </span><span class="kn">import</span> <span class="n">beamline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion.graph.tof</span><span class="w"> </span><span class="kn">import</span> <span class="n">elastic</span>

<span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="o">**</span><span class="n">elastic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">)}</span>
<span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_13_0.svg" src="../_images/user-guide_coordinate-transformations_13_0.svg" />
</div>
</div>
<p>We use the following powder diffraction data to demonstrate the conversion:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scippneutron</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">scn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scippneutron.data</span>

<span class="n">da</span> <span class="o">=</span> <span class="n">scn</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">powder_sample</span><span class="p">()[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">da</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FrameworkManager-[Notice] Welcome to Mantid 6.13.0
FrameworkManager-[Notice] Please cite: http://dx.doi.org/10.1016/j.nima.2014.07.029 and this release: http://dx.doi.org/10.5286/Software/Mantid6.13
DllOpen-[Error] Could not open library /home/runner/micromamba/envs/ubuntu-latest/plugins/libMantidMuon.so: libMantidCurveFitting.so: cannot open shared object file: No such file or directory
CheckMantidVersion-[Notice] A new version of Mantid(6.14.0) is available for download from https://download.mantidproject.org
DownloadInstrument-[Notice] All instrument definitions up to date
Load-[Notice] Load started
Load-[Notice] Load successful, Duration 1.72 seconds
DeleteWorkspace-[Notice] DeleteWorkspace started
DeleteWorkspace-[Notice] DeleteWorkspace successful, Duration 0.00 seconds
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (411.36 MB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-2dae05ab-1773-4022-aeba-a00e2a3ffad5' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-2dae05ab-1773-4022-aeba-a00e2a3ffad5' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>spectrum</span>: 24794</li><li><span class='sc-has-index'>tof</span>: 1</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-29d7db2f-e27d-461a-8e55-89cd0fdfd257' class='sc-section-summary-in' type='checkbox'  checked><label for='section-29d7db2f-e27d-461a-8e55-89cd0fdfd257' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(5)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>position</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 1.17451004 -1.01106149 -2.03796699], [ 1.18147634 -0.95946649 -2.05334117], ..., [1.81428985 0.09565841 3.84338287], [1.81375055 0.1499371  3.84269584]</div></span></div><input id='attrs-3932d0f5-625c-44be-bc2e-52a511dc6fed' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3932d0f5-625c-44be-bc2e-52a511dc6fed' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-209df5b8-f4e2-4c69-aaa6-5db3a4a5e055' class='sc-var-data-in' type='checkbox'><label for='data-209df5b8-f4e2-4c69-aaa6-5db3a4a5e055' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 1.17451004, -1.01106149, -2.03796699],
       [ 1.18147634, -0.95946649, -2.05334117],
       [ 1.18844265, -0.90787149, -2.06871534],
       ...,
       [ 1.81482915,  0.04137972,  3.8440699 ],
       [ 1.81428985,  0.09565841,  3.84338287],
       [ 1.81375055,  0.1499371 ,  3.84269584]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-3e2d40f3-14d3-490a-ba9a-4b608655c882' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3e2d40f3-14d3-490a-ba9a-4b608655c882' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-45672c3a-99b8-4ef5-8458-531130324fdd' class='sc-var-data-in' type='checkbox'><label for='data-45672c3a-99b8-4ef5-8458-531130324fdd' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[  0.   0. -60.]</div></span></div><input id='attrs-03e6980c-28e7-482a-95fc-343290da6a34' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-03e6980c-28e7-482a-95fc-343290da6a34' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-13fc4861-510b-462c-95ad-b7a77fb4f378' class='sc-var-data-in' type='checkbox'><label for='data-13fc4861-510b-462c-95ad-b7a77fb4f378' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  0.,   0., -60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>spectrum</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>int32</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>1, 2, ..., 24793, 24794</div></span></div><input id='attrs-527e1882-1440-4c13-83e7-b8eda53e0f06' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-527e1882-1440-4c13-83e7-b8eda53e0f06' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-196f7b3b-2642-4878-83ce-bdb78a55e111' class='sc-var-data-in' type='checkbox'><label for='data-196f7b3b-2642-4878-83ce-bdb78a55e111' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([    1,     2,     3, ..., 24792, 24793, 24794], dtype=int32)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>tof</span></div><div class='sc-var-dims'>(tof [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>20.0, 1.669e+04</div></span></div><input id='attrs-2091ec65-2523-4262-91c7-04a075bdf68c' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-2091ec65-2523-4262-91c7-04a075bdf68c' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ad8c443b-5b9f-47d5-8c9d-a07fd9f00550' class='sc-var-data-in' type='checkbox'><label for='data-ad8c443b-5b9f-47d5-8c9d-a07fd9f00550' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([   20.        , 16694.30078125])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-b8d2646e-9228-4282-a757-87f728f2f25b' class='sc-section-summary-in' type='checkbox'  checked><label for='section-b8d2646e-9228-4282-a757-87f728f2f25b' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(spectrum, tof)</div><div class='sc-var-dtype'>float32</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>binned data [len=0, len=0, ..., len=0, len=0]</div></span></div><input id='attrs-838a67e2-dc82-4f5e-99aa-75feeee913ee' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-838a67e2-dc82-4f5e-99aa-75feeee913ee' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-beb3fa53-dd2c-40d4-a943-7784781d016a' class='sc-var-data-in' type='checkbox'><label for='data-beb3fa53-dd2c-40d4-a943-7784781d016a' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>dim=&#x27;event&#x27;,
content=DataArray(
          dims=(event: 17926980),
          data=float32[counts],
          coords={&#x27;tof&#x27;:float64[µs], &#x27;pulse_time&#x27;:datetime64[ns]})</pre></li></ul></div></li></ul></div></div></div>
</div>
<p>The result after applying the coordinate transformation is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (549.46 MB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-b316b6d3-f0fa-4e8f-abc2-5f871b085307' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-b316b6d3-f0fa-4e8f-abc2-5f871b085307' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>spectrum</span>: 24794</li><li><span class='sc-has-index'>wavelength</span>: 1</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-5dbc0d47-97a7-4f61-be6b-076e6c3e0b34' class='sc-section-summary-in' type='checkbox'  checked><label for='section-5dbc0d47-97a7-4f61-be6b-076e6c3e0b34' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(11)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>L1</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>60.0</div></span></div><input id='attrs-3eae02e4-9b46-4932-87c0-aa64d40b92a4' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3eae02e4-9b46-4932-87c0-aa64d40b92a4' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-087b4658-1ead-4a5f-bf7c-e7a113660eef' class='sc-var-data-in' type='checkbox'><label for='data-087b4658-1ead-4a5f-bf7c-e7a113660eef' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(60.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>L2</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>2.560, 2.556, ..., 4.251, 4.252</div></span></div><input id='attrs-61c83724-2756-4dda-8605-dfda6586aa1c' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-61c83724-2756-4dda-8605-dfda6586aa1c' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c8ce18cd-85cf-4ac4-a7d0-0cb583a1ee39' class='sc-var-data-in' type='checkbox'><label for='data-c8ce18cd-85cf-4ac4-a7d0-0cb583a1ee39' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([2.56027902, 2.55590928, 2.55268677, ..., 4.25113991, 4.25116338,
       4.25188   ])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>Ltotal</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>62.560, 62.556, ..., 64.251, 64.252</div></span></div><input id='attrs-ed4b7143-8a5f-412c-8a37-0dd4c66c6aef' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-ed4b7143-8a5f-412c-8a37-0dd4c66c6aef' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-52e01ca1-9d22-4931-970b-bbc95c62a7b9' class='sc-var-data-in' type='checkbox'><label for='data-52e01ca1-9d22-4931-970b-bbc95c62a7b9' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([62.56027902, 62.55590928, 62.55268677, ..., 64.25113991,
       64.25116338, 64.25188   ])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>incident_beam</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.  0. 60.]</div></span></div><input id='attrs-6c5340da-6c62-4a57-97f2-fa1b8b08c9c7' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6c5340da-6c62-4a57-97f2-fa1b8b08c9c7' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f6399095-496a-4276-8074-ab9456782cec' class='sc-var-data-in' type='checkbox'><label for='data-f6399095-496a-4276-8074-ab9456782cec' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0.,  0., 60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>position</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 1.17451004 -1.01106149 -2.03796699], [ 1.18147634 -0.95946649 -2.05334117], ..., [1.81428985 0.09565841 3.84338287], [1.81375055 0.1499371  3.84269584]</div></span></div><input id='attrs-c6d6fb74-1611-4ba4-a1fa-a618c01d7e64' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-c6d6fb74-1611-4ba4-a1fa-a618c01d7e64' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9e5dfe2f-38a9-44b0-b132-a5cc229ad480' class='sc-var-data-in' type='checkbox'><label for='data-9e5dfe2f-38a9-44b0-b132-a5cc229ad480' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 1.17451004, -1.01106149, -2.03796699],
       [ 1.18147634, -0.95946649, -2.05334117],
       [ 1.18844265, -0.90787149, -2.06871534],
       ...,
       [ 1.81482915,  0.04137972,  3.8440699 ],
       [ 1.81428985,  0.09565841,  3.84338287],
       [ 1.81375055,  0.1499371 ,  3.84269584]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-cd60d60f-3a41-4e37-8afe-8a443ea9fd52' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-cd60d60f-3a41-4e37-8afe-8a443ea9fd52' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-071d746a-b360-4bff-a608-fc5971eb534c' class='sc-var-data-in' type='checkbox'><label for='data-071d746a-b360-4bff-a608-fc5971eb534c' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>scattered_beam</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 1.17451004 -1.01106149 -2.03796699], [ 1.18147634 -0.95946649 -2.05334117], ..., [1.81428985 0.09565841 3.84338287], [1.81375055 0.1499371  3.84269584]</div></span></div><input id='attrs-a553a8f4-c55d-483e-9a03-ba50ae9cb0e0' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-a553a8f4-c55d-483e-9a03-ba50ae9cb0e0' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7e87068e-3f25-41a7-b6df-0832cca92f0e' class='sc-var-data-in' type='checkbox'><label for='data-7e87068e-3f25-41a7-b6df-0832cca92f0e' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 1.17451004, -1.01106149, -2.03796699],
       [ 1.18147634, -0.95946649, -2.05334117],
       [ 1.18844265, -0.90787149, -2.06871534],
       ...,
       [ 1.81482915,  0.04137972,  3.8440699 ],
       [ 1.81428985,  0.09565841,  3.84338287],
       [ 1.81375055,  0.1499371 ,  3.84269584]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[  0.   0. -60.]</div></span></div><input id='attrs-1a0a74f2-ae73-4f3a-8efe-4aeeb352676b' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1a0a74f2-ae73-4f3a-8efe-4aeeb352676b' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9d5e7e5a-d0c0-4238-8b6e-1eb5a19d8f0d' class='sc-var-data-in' type='checkbox'><label for='data-9d5e7e5a-d0c0-4238-8b6e-1eb5a19d8f0d' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  0.,   0., -60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>spectrum</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>int32</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>1, 2, ..., 24793, 24794</div></span></div><input id='attrs-8eed67f2-2ed4-45c8-b5e5-931af2ea7511' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-8eed67f2-2ed4-45c8-b5e5-931af2ea7511' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-04342e2c-ba91-4569-94d3-8dc3e05935a4' class='sc-var-data-in' type='checkbox'><label for='data-04342e2c-ba91-4569-94d3-8dc3e05935a4' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([    1,     2,     3, ..., 24792, 24793, 24794], dtype=int32)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(wavelength [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>20.0, 1.669e+04</div></span></div><input id='attrs-b11cdff9-a1b6-4fc7-9dba-0412e668963a' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-b11cdff9-a1b6-4fc7-9dba-0412e668963a' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9f51c647-607a-4a6c-9ca5-1c7d0d0372aa' class='sc-var-data-in' type='checkbox'><label for='data-9f51c647-607a-4a6c-9ca5-1c7d0d0372aa' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([   20.        , 16694.30078125])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>wavelength</span></div><div class='sc-var-dims'>(spectrum, wavelength [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.001, 1.056, ..., 0.001, 1.028</div></span></div><input id='attrs-b1a93851-3917-4968-8fa2-97f4a0536e02' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-b1a93851-3917-4968-8fa2-97f4a0536e02' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4e2200b2-c099-4aae-bcf9-8e4527231a34' class='sc-var-data-in' type='checkbox'><label for='data-4e2200b2-c099-4aae-bcf9-8e4527231a34' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.00126471, 1.05567339],
       [0.0012648 , 1.05574713],
       [0.00126486, 1.05580152],
       ...,
       [0.00123143, 1.02789183],
       [0.00123143, 1.02789145],
       [0.00123141, 1.02787999]])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-83261951-7b85-4534-bae1-b02faae725ea' class='sc-section-summary-in' type='checkbox'  checked><label for='section-83261951-7b85-4534-bae1-b02faae725ea' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(spectrum, wavelength)</div><div class='sc-var-dtype'>float32</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>binned data [len=0, len=0, ..., len=0, len=0]</div></span></div><input id='attrs-27e35acb-4003-4c9d-96af-4e7ad5525cb5' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-27e35acb-4003-4c9d-96af-4e7ad5525cb5' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c86ee2b7-d203-44c7-9d74-b354d818bea0' class='sc-var-data-in' type='checkbox'><label for='data-c86ee2b7-d203-44c7-9d74-b354d818bea0' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>dim=&#x27;event&#x27;,
content=DataArray(
          dims=(event: 17926980),
          data=float32[counts],
          coords={&#x27;tof&#x27;:float64[µs], &#x27;pulse_time&#x27;:datetime64[ns], &#x27;wavelength&#x27;:float64[Å]})</pre></li></ul></div></li></ul></div></div></div>
</div>
<p>Note how <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code> automatically handles event data.</p>
</section>
</section>
<section id="Customizing-transformations">
<h2>Customizing transformations<a class="headerlink" href="#Customizing-transformations" title="Link to this heading">#</a></h2>
<p>Many neutron beamlines are more complex than what is assumed by the simple built-in transformation graphs. The coordinate transformation mechanism is completely generic and is customizable. We provide four examples:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#Gravity-correction"><span class="std std-ref">Gravity correction</span></a> demonstrates how to replace a node in an existing graph. The example takes into account a gravity drop of scattered neutrons when computing <span class="math notranslate nohighlight">\(2\theta\)</span>.</p></li>
<li><p><a class="reference internal" href="#Plane-wave-beam"><span class="std std-ref">Plane wave beam</span></a> demonstrates how to replace a node in an existing graph. The example computes <span class="math notranslate nohighlight">\(L_{\text{total}}\)</span> not using a straight-line definition (which assumes a point-like source) but instead used the direction of the incident beam. This could be used for imaging beamlines to ensure that all image sensor pixels have identical wavelength coordinates.</p></li>
<li><p><a class="reference internal" href="#Diffraction-calibration"><span class="std std-ref">Diffraction calibration</span></a> demonstrates a completely custom transformation without use of pre-defined graphs. The example uses calibration results to compute the interplanar lattice spacing <span class="math notranslate nohighlight">\(d\)</span>, instead of computing <span class="math notranslate nohighlight">\(d\)</span> using positions of beamline components.</p></li>
<li><p><a class="reference internal" href="#2-D-Rietveld"><span class="std std-ref">2-D Rietveld</span></a> demonstrates how a new node is added to an existing graph. The example computes <span class="math notranslate nohighlight">\(d_{\text{perp}}\)</span> and <span class="math notranslate nohighlight">\(d\)</span> as used in 2-D Rietveld. This also demonstrates how to continue working with data with multiple output coordinates using binning.</p></li>
</ol>
<section id="Gravity-correction">
<h3>Gravity correction<a class="headerlink" href="#Gravity-correction" title="Link to this heading">#</a></h3>
<p>For techniques such as SANS which are probing low Q regions, the basic conversion approach may not be sufficient. A computation of <span class="math notranslate nohighlight">\(2\theta\)</span> may need to take into account gravity since the gravity drop after scattering is not negligible. This can be achieved by replacing the function for computation of <code class="docutils literal notranslate"><span class="pre">two_theta</span></code> that is defined as part of <code class="docutils literal notranslate"><span class="pre">conversion.graph.beamline.beamline(scatter=True)</span></code>.</p>
<p>ScippNeutron provides <a class="reference internal" href="../generated/modules/scippneutron.conversion.beamline.scattering_angles_with_gravity.html"><span class="doc">scn.conversion.beamline.scattering_angles_with_gravity</span></a> which computes both the polar scattering angle <code class="docutils literal notranslate"><span class="pre">two_theta</span></code> and the azimuthal angle <code class="docutils literal notranslate"><span class="pre">phi</span></code>. To insert it into the graph, first remove the default function for <code class="docutils literal notranslate"><span class="pre">two_theta</span></code> and then insert <code class="docutils literal notranslate"><span class="pre">scattering_angles_with_gravity</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">beamline</span><span class="p">,</span> <span class="n">graph</span>

<span class="n">q_with_gravity</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">graph</span><span class="o">.</span><span class="n">beamline</span><span class="o">.</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="o">**</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">elastic_Q</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">)}</span>
<span class="k">del</span> <span class="n">q_with_gravity</span><span class="p">[</span><span class="s2">&quot;two_theta&quot;</span><span class="p">]</span>
<span class="n">q_with_gravity</span><span class="p">[(</span><span class="s2">&quot;two_theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">beamline</span><span class="o">.</span><span class="n">scattering_angles_with_gravity</span>
</pre></div>
</div>
</div>
<p>The result is as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">q_with_gravity</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_23_0.svg" src="../_images/user-guide_coordinate-transformations_23_0.svg" />
</div>
</div>
<p>We can use this to convert SANS data to <span class="math notranslate nohighlight">\(Q\)</span>. Our custom transformation graph requires a <code class="docutils literal notranslate"><span class="pre">gravity</span></code> input coordinate, so we define one. In this case (LARMOR beamline) “up” is along the <code class="docutils literal notranslate"><span class="pre">y</span></code> axis:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scippneutron</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">scn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipp.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">g</span>

<span class="n">da</span> <span class="o">=</span> <span class="n">scn</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tutorial_dense_data</span><span class="p">()[</span><span class="s1">&#39;detector&#39;</span><span class="p">]</span>
<span class="c1"># Convert to bin centers so we can later bin into Q bins</span>
<span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;tof&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;tof&quot;</span><span class="p">][</span><span class="s2">&quot;tof&quot;</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;tof&quot;</span><span class="p">][</span><span class="s2">&quot;tof&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>
<span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;gravity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">g</span>
<span class="n">da_gravity</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">q_with_gravity</span><span class="p">)</span>
<span class="n">da_gravity</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (1.03 GB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-d7e944ce-2379-496f-8fdf-8c16bfc77b0c' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-d7e944ce-2379-496f-8fdf-8c16bfc77b0c' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>spectrum</span>: 114688</li><li><span class='sc-has-index'>wavelength</span>: 200</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-fbda1d0b-18d2-432e-96fc-f31d4c64b1f9' class='sc-section-summary-in' type='checkbox'  checked><label for='section-fbda1d0b-18d2-432e-96fc-f31d4c64b1f9' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(15)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>L1</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>25.3</div></span></div><input id='attrs-819161af-567c-4230-a0ca-94fb3fb347b1' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-819161af-567c-4230-a0ca-94fb3fb347b1' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-240c2a4c-4b37-4db7-b1a5-79a932c48952' class='sc-var-data-in' type='checkbox'><label for='data-240c2a4c-4b37-4db7-b1a5-79a932c48952' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(25.3)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>L2</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>4.627, 4.626, ..., 4.688, 4.688</div></span></div><input id='attrs-1b588ba2-6a65-4296-9d7b-df1f47eafc7b' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1b588ba2-6a65-4296-9d7b-df1f47eafc7b' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d32aebae-244e-4622-8d34-813d96bd2823' class='sc-var-data-in' type='checkbox'><label for='data-d32aebae-244e-4622-8d34-813d96bd2823' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([4.62652824, 4.62603552, 4.62554461, ..., 4.68779261, 4.68807737,
       4.6883633 ])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>Ltotal</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>29.927, 29.926, ..., 29.988, 29.988</div></span></div><input id='attrs-f573b210-2dd2-42c8-b22f-f848f2c1a612' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-f573b210-2dd2-42c8-b22f-f848f2c1a612' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e859c286-a2f5-469f-a414-8aa1c4fcef1f' class='sc-var-data-in' type='checkbox'><label for='data-e859c286-a2f5-469f-a414-8aa1c4fcef1f' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([29.92652824, 29.92603552, 29.92554461, ..., 29.98779261,
       29.98807737, 29.9883633 ])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>Q</span></div><div class='sc-var-dims'>(spectrum, wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>1/Å</div><div class='sc-value-preview sc-preview'><span><div>31.901, 10.774, ..., 0.059, 0.058</div></span></div><input id='attrs-33862288-7610-496e-89df-96b052b704b2' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-33862288-7610-496e-89df-96b052b704b2' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3af0c6d1-dbc9-4b62-8969-cedb82487cde' class='sc-var-data-in' type='checkbox'><label for='data-3af0c6d1-dbc9-4b62-8969-cedb82487cde' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[31.90066148, 10.77440273,  6.48181301, ...,  0.08239169,
         0.08197683,  0.08156614],
       [31.78561924, 10.73554737,  6.45843788, ...,  0.0820947 ,
         0.08168135,  0.08127213],
       [31.67056726, 10.69668873,  6.43506076, ...,  0.08179769,
         0.08138583,  0.0809781 ],
       ...,
       [22.66447335,  7.65489329,  4.60513557, ...,  0.0585184 ,
         0.05822357,  0.05793169],
       [22.75731848,  7.6862516 ,  4.62400054, ...,  0.05875816,
         0.05846212,  0.05816904],
       [22.85015418,  7.71760672,  4.64286358, ...,  0.0589979 ,
         0.05870065,  0.05840638]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>gravity</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m/s^2</div><div class='sc-value-preview sc-preview'><span><div>[ 0.      -9.80665  0.     ]</div></span></div><input id='attrs-48af161a-f036-468e-9ea9-b53305d336b4' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-48af161a-f036-468e-9ea9-b53305d336b4' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-40d31bf6-6b9f-4f1b-af23-e76bb8595210' class='sc-var-data-in' type='checkbox'><label for='data-40d31bf6-6b9f-4f1b-af23-e76bb8595210' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0.     , -9.80665,  0.     ])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>incident_beam</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.   0.  25.3]</div></span></div><input id='attrs-bd49fbc4-83d8-4167-9c10-fd80b36ed9a7' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-bd49fbc4-83d8-4167-9c10-fd80b36ed9a7' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ce465d89-a129-4dd8-ba6c-a14720400e31' class='sc-var-data-in' type='checkbox'><label for='data-ce465d89-a129-4dd8-ba6c-a14720400e31' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0. ,  0. , 25.3])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>phi</span></div><div class='sc-var-dims'>(spectrum, wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>rad</div><div class='sc-value-preview sc-preview'><span><div>0.166, 0.166, ..., -3.104, -3.104</div></span></div><input id='attrs-4fed4cb0-ce75-44d4-bccc-9030d6f259ff' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4fed4cb0-ce75-44d4-bccc-9030d6f259ff' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e4420e13-6db9-4474-a00d-dffc16d21609' class='sc-var-data-in' type='checkbox'><label for='data-e4420e13-6db9-4474-a00d-dffc16d21609' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 0.16614881,  0.16614888,  0.16614903, ...,  0.16757715,
         0.16759165,  0.16760622],
       [ 0.16676649,  0.16676656,  0.16676671, ...,  0.16819968,
         0.16821423,  0.16822884],
       [ 0.16738873,  0.16738881,  0.16738895, ...,  0.16882681,
         0.16884141,  0.16885607],
       ...,
       [-3.10130851, -3.10130861, -3.10130882, ..., -3.10336499,
        -3.10338587, -3.10340685],
       [-3.1014744 , -3.1014745 , -3.10147471, ..., -3.10352264,
        -3.10354343, -3.10356433],
       [-3.10163892, -3.10163903, -3.10163924, ..., -3.10367899,
        -3.10369971, -3.10372052]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>position</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.778       0.13046651 29.85877813], [ 0.77506458  0.13046651 29.85877813], ..., [-5.69651663e-01 -2.28657089e-02  2.99532831e+01], [-5.72000000e-01 -2.28657089e-02  2.99532831e+01]</div></span></div><input id='attrs-211d81d9-e494-49d2-bdbc-ef7cece9b057' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-211d81d9-e494-49d2-bdbc-ef7cece9b057' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-275e38af-b192-4402-b667-63dcd0f88266' class='sc-var-data-in' type='checkbox'><label for='data-275e38af-b192-4402-b667-63dcd0f88266' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 7.78000000e-01,  1.30466508e-01,  2.98587781e+01],
       [ 7.75064579e-01,  1.30466508e-01,  2.98587781e+01],
       [ 7.72129159e-01,  1.30466508e-01,  2.98587781e+01],
       ...,
       [-5.67303327e-01, -2.28657089e-02,  2.99532831e+01],
       [-5.69651663e-01, -2.28657089e-02,  2.99532831e+01],
       [-5.72000000e-01, -2.28657089e-02,  2.99532831e+01]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.   0.  25.3]</div></span></div><input id='attrs-ac03e328-13a1-48ad-a4e5-56c5f705c5b9' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-ac03e328-13a1-48ad-a4e5-56c5f705c5b9' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-548f8127-4832-43e7-8f4b-3c6d65187388' class='sc-var-data-in' type='checkbox'><label for='data-548f8127-4832-43e7-8f4b-3c6d65187388' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0. ,  0. , 25.3])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>scattered_beam</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0.778      0.13046651 4.55877813], [0.77506458 0.13046651 4.55877813], ..., [-0.56965166 -0.02286571  4.6532831 ], [-0.572      -0.02286571  4.6532831 ]</div></span></div><input id='attrs-85805179-2d69-48ed-8110-e959a995e6dd' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-85805179-2d69-48ed-8110-e959a995e6dd' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c653c4c2-57ca-406d-842a-ec344948b4f6' class='sc-var-data-in' type='checkbox'><label for='data-c653c4c2-57ca-406d-842a-ec344948b4f6' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 0.778     ,  0.13046651,  4.55877813],
       [ 0.77506458,  0.13046651,  4.55877813],
       [ 0.77212916,  0.13046651,  4.55877813],
       ...,
       [-0.56730333, -0.02286571,  4.6532831 ],
       [-0.56965166, -0.02286571,  4.6532831 ],
       [-0.572     , -0.02286571,  4.6532831 ]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-51801dbc-ee6d-438b-9ba0-4060ad17eb2c' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-51801dbc-ee6d-438b-9ba0-4060ad17eb2c' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ff0d819c-5a10-4352-9e97-a6883b5a9051' class='sc-var-data-in' type='checkbox'><label for='data-ff0d819c-5a10-4352-9e97-a6883b5a9051' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>spectrum</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>int32</div><div class='sc-var-unit'>𝟙</div><div class='sc-value-preview sc-preview'><span><div>11, 12, ..., 114697, 114698</div></span></div><input id='attrs-febb2f20-1871-4927-b4db-c495736ff419' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-febb2f20-1871-4927-b4db-c495736ff419' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ed554dca-dffd-4ed4-a964-e90a5a3978c5' class='sc-var-data-in' type='checkbox'><label for='data-ed554dca-dffd-4ed4-a964-e90a5a3978c5' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([    11,     12,     13, ..., 114696, 114697, 114698], dtype=int32)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>254.988, 754.963, ..., 9.925e+04, 9.975e+04</div></span></div><input id='attrs-3948a1cc-158a-49e9-82f8-a48074a2c3b4' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3948a1cc-158a-49e9-82f8-a48074a2c3b4' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ec2c0e1b-2ed4-4208-a512-65375f4a48ad' class='sc-var-data-in' type='checkbox'><label for='data-ec2c0e1b-2ed4-4208-a512-65375f4a48ad' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  254.9875,   754.9625,  1254.9375,  1754.9125,  2254.8875,
        2754.8625,  3254.8375,  3754.8125,  4254.7875,  4754.7625,
        5254.7375,  5754.7125,  6254.6875,  6754.6625,  7254.6375,
        7754.6125,  8254.5875,  8754.5625,  9254.5375,  9754.5125,
       10254.4875, 10754.4625, 11254.4375, 11754.4125, 12254.3875,
       12754.3625, 13254.3375, 13754.3125, 14254.2875, 14754.2625,
       15254.2375, 15754.2125, 16254.1875, 16754.1625, 17254.1375,
       17754.1125, 18254.0875, 18754.0625, 19254.0375, 19754.0125,
       20253.9875, 20753.9625, 21253.9375, 21753.9125, 22253.8875,
       22753.8625, 23253.8375, 23753.8125, 24253.7875, 24753.7625,
       25253.7375, 25753.7125, 26253.6875, 26753.6625, 27253.6375,
       27753.6125, 28253.5875, 28753.5625, 29253.5375, 29753.5125,
       30253.4875, 30753.4625, 31253.4375, 31753.4125, 32253.3875,
       32753.3625, 33253.3375, 33753.3125, 34253.2875, 34753.2625,
       35253.2375, 35753.2125, 36253.1875, 36753.1625, 37253.1375,
       37753.1125, 38253.0875, 38753.0625, 39253.0375, 39753.0125,
       40252.9875, 40752.9625, 41252.9375, 41752.9125, 42252.8875,
       42752.8625, 43252.8375, 43752.8125, 44252.7875, 44752.7625,
       45252.7375, 45752.7125, 46252.6875, 46752.6625, 47252.6375,
       47752.6125, 48252.5875, 48752.5625, 49252.5375, 49752.5125,
       50252.4875, 50752.4625, 51252.4375, 51752.4125, 52252.3875,
       52752.3625, 53252.3375, 53752.3125, 54252.2875, 54752.2625,
       55252.2375, 55752.2125, 56252.1875, 56752.1625, 57252.1375,
       57752.1125, 58252.0875, 58752.0625, 59252.0375, 59752.0125,
       60251.9875, 60751.9625, 61251.9375, 61751.9125, 62251.8875,
       62751.8625, 63251.8375, 63751.8125, 64251.7875, 64751.7625,
       65251.7375, 65751.7125, 66251.6875, 66751.6625, 67251.6375,
       67751.6125, 68251.5875, 68751.5625, 69251.5375, 69751.5125,
       70251.4875, 70751.4625, 71251.4375, 71751.4125, 72251.3875,
       72751.3625, 73251.3375, 73751.3125, 74251.2875, 74751.2625,
       75251.2375, 75751.2125, 76251.1875, 76751.1625, 77251.1375,
       77751.1125, 78251.0875, 78751.0625, 79251.0375, 79751.0125,
       80250.9875, 80750.9625, 81250.9375, 81750.9125, 82250.8875,
       82750.8625, 83250.8375, 83750.8125, 84250.7875, 84750.7625,
       85250.7375, 85750.7125, 86250.6875, 86750.6625, 87250.6375,
       87750.6125, 88250.5875, 88750.5625, 89250.5375, 89750.5125,
       90250.4875, 90750.4625, 91250.4375, 91750.4125, 92250.3875,
       92750.3625, 93250.3375, 93750.3125, 94250.2875, 94750.2625,
       95250.2375, 95750.2125, 96250.1875, 96750.1625, 97250.1375,
       97750.1125, 98250.0875, 98750.0625, 99250.0375, 99750.0125])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>two_theta</span></div><div class='sc-var-dims'>(spectrum, wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>rad</div><div class='sc-value-preview sc-preview'><span><div>0.171, 0.171, ..., 0.122, 0.122</div></span></div><input id='attrs-05b0cd0c-7d55-4a8a-ac77-b0283d4c2c1a' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-05b0cd0c-7d55-4a8a-ac77-b0283d4c2c1a' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a94c71f7-7c31-4c28-840d-d9e493de610f' class='sc-var-data-in' type='checkbox'><label for='data-a94c71f7-7c31-4c28-840d-d9e493de610f' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.17134593, 0.17134593, 0.17134594, ..., 0.17138636, 0.17138677,
        0.17138718],
       [0.17072932, 0.17072932, 0.17072933, ..., 0.1707699 , 0.17077031,
        0.17077073],
       [0.17011265, 0.17011265, 0.17011265, ..., 0.17015337, 0.17015379,
        0.1701542 ],
       ...,
       [0.12141349, 0.12141349, 0.12141349, ..., 0.12140378, 0.12140369,
        0.12140359],
       [0.12191032, 0.12191032, 0.12191032, ..., 0.12190065, 0.12190056,
        0.12190046],
       [0.12240709, 0.12240709, 0.12240709, ..., 0.12239746, 0.12239737,
        0.12239727]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>wavelength</span></div><div class='sc-var-dims'>(spectrum, wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.034, 0.100, ..., 13.093, 13.159</div></span></div><input id='attrs-3fe74b43-917d-4fae-b35b-25d33d869d9c' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3fe74b43-917d-4fae-b35b-25d33d869d9c' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-51fb110e-fb23-4185-b7d1-c227352376ab' class='sc-var-data-in' type='checkbox'><label for='data-51fb110e-fb23-4185-b7d1-c227352376ab' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 0.03370719,  0.09979966,  0.16589213, ..., 13.05392334,
        13.1200158 , 13.18610827],
       [ 0.03370775,  0.0998013 ,  0.16589486, ..., 13.05413826,
        13.12023182, 13.18632537],
       [ 0.0337083 ,  0.09980294,  0.16589758, ..., 13.05435241,
        13.12044705, 13.18654169],
       ...,
       [ 0.03363833,  0.09959577,  0.16555321, ..., 13.02725447,
        13.09321192, 13.15916936],
       [ 0.03363801,  0.09959483,  0.16555164, ..., 13.02713077,
        13.09308758, 13.1590444 ],
       [ 0.03363769,  0.09959388,  0.16555006, ..., 13.02700656,
        13.09296274, 13.15891893]])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-61b4d463-6d20-43fb-a8dd-cba71819efeb' class='sc-section-summary-in' type='checkbox'  checked><label for='section-61b4d463-6d20-43fb-a8dd-cba71819efeb' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(spectrum, wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>0.0, 0.0, ..., 0.0, 0.0</div></span><span><div>σ = 0.0, 0.0, ..., 0.0, 0.0</div></span></div><input id='attrs-3aa1813e-505f-409a-b8a6-71ee7de4709d' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3aa1813e-505f-409a-b8a6-71ee7de4709d' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9fb696b4-fd6e-4a84-b551-6d901b35267a' class='sc-var-data-in' type='checkbox'><label for='data-9fb696b4-fd6e-4a84-b551-6d901b35267a' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]])<br><br>Variances (σ²):<br>array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]])</pre></li></ul></div></li></ul></div></div></div>
</div>
<p>As a final step we may then bin our data into <span class="math notranslate nohighlight">\(Q\)</span> bins:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q_bins</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;1/angstrom&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">da_gravity</span> <span class="o">=</span> <span class="n">da_gravity</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="n">q_bins</span><span class="p">)</span>
<span class="n">da_gravity</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_27_0.svg" src="../_images/user-guide_coordinate-transformations_27_0.svg" />
</div>
</div>
</section>
<section id="Plane-wave-beam">
<h3>Plane wave beam<a class="headerlink" href="#Plane-wave-beam" title="Link to this heading">#</a></h3>
<p>The built-in <code class="docutils literal notranslate"><span class="pre">conversion.graph.beamline.beamline(scatter=False)</span></code> assumes a straight line from source to detector, i.e., treats the source as a point. If we use this to compute <code class="docutils literal notranslate"><span class="pre">wavelength</span></code> for an imaging beamline this will result in different wavelengths for each image sensor pixel, which may be undesirable. We can define a custom <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code> function to compute the average distance along the beam:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">graph</span>


<span class="k">def</span><span class="w"> </span><span class="nf">Ltotal</span><span class="p">(</span><span class="n">incident_beam</span><span class="p">,</span> <span class="n">source_position</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">incident_beam</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">incident_beam</span><span class="p">)</span>
    <span class="n">projected</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">projected</span><span class="p">)</span> <span class="o">-</span> <span class="n">source_position</span><span class="p">)</span>


<span class="n">plane_graph</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">graph</span><span class="o">.</span><span class="n">beamline</span><span class="o">.</span><span class="n">incident_beam</span><span class="p">(),</span> <span class="o">**</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">kinematic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">)}</span>
<span class="n">plane_graph</span><span class="p">[</span><span class="s2">&quot;Ltotal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ltotal</span>
<span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">plane_graph</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_29_0.svg" src="../_images/user-guide_coordinate-transformations_29_0.svg" />
</div>
</div>
<p>Note how <code class="docutils literal notranslate"><span class="pre">Ltotal</span></code> uses the <em>mean</em> of the projected position to ensure that the coordinate transformation will produce a <code class="docutils literal notranslate"><span class="pre">wavelength</span></code> coordinate that does not depend on the pixel:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scippneutron</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">scn</span>

<span class="n">da</span> <span class="o">=</span> <span class="n">scn</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tutorial_dense_data</span><span class="p">()[</span>
    <span class="s1">&#39;detector&#39;</span>
<span class="p">]</span>  <span class="c1"># Note that this is actually a SANS beamline, not an imaging beamline</span>
<span class="n">da_plane</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">plane_graph</span><span class="p">)</span>
<span class="n">da_plane</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (353.07 MB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-0ee4373f-4a8b-4de1-8792-36986ea2acc3' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-0ee4373f-4a8b-4de1-8792-36986ea2acc3' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>spectrum</span>: 114688</li><li><span class='sc-has-index'>wavelength</span>: 200</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-2993d485-4576-4c49-99aa-d1e186e3f239' class='sc-section-summary-in' type='checkbox'  checked><label for='section-2993d485-4576-4c49-99aa-d1e186e3f239' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(8)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>Ltotal</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>29.906030613062498</div></span></div><input id='attrs-925aed64-d957-4b7a-ab11-1fc53d3fccf1' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-925aed64-d957-4b7a-ab11-1fc53d3fccf1' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-63527408-d207-4ee9-b88b-ab26808f8502' class='sc-var-data-in' type='checkbox'><label for='data-63527408-d207-4ee9-b88b-ab26808f8502' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(29.90603061)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>incident_beam</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.   0.  25.3]</div></span></div><input id='attrs-a8f2dab9-633e-469b-b138-c262229c2d60' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-a8f2dab9-633e-469b-b138-c262229c2d60' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b60a618c-d895-4e8c-a275-aea48c359369' class='sc-var-data-in' type='checkbox'><label for='data-b60a618c-d895-4e8c-a275-aea48c359369' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0. ,  0. , 25.3])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>position</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.778       0.13046651 29.85877813], [ 0.77506458  0.13046651 29.85877813], ..., [-5.69651663e-01 -2.28657089e-02  2.99532831e+01], [-5.72000000e-01 -2.28657089e-02  2.99532831e+01]</div></span></div><input id='attrs-33abaf9e-eb85-4d74-a9b3-b4a4812d0210' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-33abaf9e-eb85-4d74-a9b3-b4a4812d0210' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-20fa2045-069b-470c-8775-51726b7027fe' class='sc-var-data-in' type='checkbox'><label for='data-20fa2045-069b-470c-8775-51726b7027fe' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 7.78000000e-01,  1.30466508e-01,  2.98587781e+01],
       [ 7.75064579e-01,  1.30466508e-01,  2.98587781e+01],
       [ 7.72129159e-01,  1.30466508e-01,  2.98587781e+01],
       ...,
       [-5.67303327e-01, -2.28657089e-02,  2.99532831e+01],
       [-5.69651663e-01, -2.28657089e-02,  2.99532831e+01],
       [-5.72000000e-01, -2.28657089e-02,  2.99532831e+01]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.   0.  25.3]</div></span></div><input id='attrs-1df99c23-8580-4258-85d9-d06da45b620f' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1df99c23-8580-4258-85d9-d06da45b620f' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9d0147d9-e99d-4876-a7b1-f55d5b3e2bb2' class='sc-var-data-in' type='checkbox'><label for='data-9d0147d9-e99d-4876-a7b1-f55d5b3e2bb2' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0. ,  0. , 25.3])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-ab571f62-990a-4fd3-a7b0-28a7557c6942' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-ab571f62-990a-4fd3-a7b0-28a7557c6942' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3ad4d3e2-7b5f-4d88-800b-93ca106a1fd1' class='sc-var-data-in' type='checkbox'><label for='data-3ad4d3e2-7b5f-4d88-800b-93ca106a1fd1' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>spectrum</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>int32</div><div class='sc-var-unit'>𝟙</div><div class='sc-value-preview sc-preview'><span><div>11, 12, ..., 114697, 114698</div></span></div><input id='attrs-6ef93c2d-d990-471d-a83a-e6a76d4e09e4' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6ef93c2d-d990-471d-a83a-e6a76d4e09e4' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-57624e72-8cb0-44ad-9541-7d76970648c8' class='sc-var-data-in' type='checkbox'><label for='data-57624e72-8cb0-44ad-9541-7d76970648c8' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([    11,     12,     13, ..., 114696, 114697, 114698], dtype=int32)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(wavelength [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>5.0, 504.975, ..., 9.950e+04, 1.000e+05</div></span></div><input id='attrs-14378bce-5b74-408e-8690-014a6b61470d' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-14378bce-5b74-408e-8690-014a6b61470d' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-826fffbf-e403-49c4-a940-770b25c22583' class='sc-var-data-in' type='checkbox'><label for='data-826fffbf-e403-49c4-a940-770b25c22583' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([5.0000000e+00, 5.0497500e+02, 1.0049500e+03, 1.5049250e+03,
       2.0049000e+03, 2.5048750e+03, 3.0048500e+03, 3.5048250e+03,
       4.0048000e+03, 4.5047750e+03, 5.0047500e+03, 5.5047250e+03,
       6.0047000e+03, 6.5046750e+03, 7.0046500e+03, 7.5046250e+03,
       8.0046000e+03, 8.5045750e+03, 9.0045500e+03, 9.5045250e+03,
       1.0004500e+04, 1.0504475e+04, 1.1004450e+04, 1.1504425e+04,
       1.2004400e+04, 1.2504375e+04, 1.3004350e+04, 1.3504325e+04,
       1.4004300e+04, 1.4504275e+04, 1.5004250e+04, 1.5504225e+04,
       1.6004200e+04, 1.6504175e+04, 1.7004150e+04, 1.7504125e+04,
       1.8004100e+04, 1.8504075e+04, 1.9004050e+04, 1.9504025e+04,
       2.0004000e+04, 2.0503975e+04, 2.1003950e+04, 2.1503925e+04,
       2.2003900e+04, 2.2503875e+04, 2.3003850e+04, 2.3503825e+04,
       2.4003800e+04, 2.4503775e+04, 2.5003750e+04, 2.5503725e+04,
       2.6003700e+04, 2.6503675e+04, 2.7003650e+04, 2.7503625e+04,
       2.8003600e+04, 2.8503575e+04, 2.9003550e+04, 2.9503525e+04,
       3.0003500e+04, 3.0503475e+04, 3.1003450e+04, 3.1503425e+04,
       3.2003400e+04, 3.2503375e+04, 3.3003350e+04, 3.3503325e+04,
       3.4003300e+04, 3.4503275e+04, 3.5003250e+04, 3.5503225e+04,
       3.6003200e+04, 3.6503175e+04, 3.7003150e+04, 3.7503125e+04,
       3.8003100e+04, 3.8503075e+04, 3.9003050e+04, 3.9503025e+04,
       4.0003000e+04, 4.0502975e+04, 4.1002950e+04, 4.1502925e+04,
       4.2002900e+04, 4.2502875e+04, 4.3002850e+04, 4.3502825e+04,
       4.4002800e+04, 4.4502775e+04, 4.5002750e+04, 4.5502725e+04,
       4.6002700e+04, 4.6502675e+04, 4.7002650e+04, 4.7502625e+04,
       4.8002600e+04, 4.8502575e+04, 4.9002550e+04, 4.9502525e+04,
       5.0002500e+04, 5.0502475e+04, 5.1002450e+04, 5.1502425e+04,
       5.2002400e+04, 5.2502375e+04, 5.3002350e+04, 5.3502325e+04,
       5.4002300e+04, 5.4502275e+04, 5.5002250e+04, 5.5502225e+04,
       5.6002200e+04, 5.6502175e+04, 5.7002150e+04, 5.7502125e+04,
       5.8002100e+04, 5.8502075e+04, 5.9002050e+04, 5.9502025e+04,
       6.0002000e+04, 6.0501975e+04, 6.1001950e+04, 6.1501925e+04,
       6.2001900e+04, 6.2501875e+04, 6.3001850e+04, 6.3501825e+04,
       6.4001800e+04, 6.4501775e+04, 6.5001750e+04, 6.5501725e+04,
       6.6001700e+04, 6.6501675e+04, 6.7001650e+04, 6.7501625e+04,
       6.8001600e+04, 6.8501575e+04, 6.9001550e+04, 6.9501525e+04,
       7.0001500e+04, 7.0501475e+04, 7.1001450e+04, 7.1501425e+04,
       7.2001400e+04, 7.2501375e+04, 7.3001350e+04, 7.3501325e+04,
       7.4001300e+04, 7.4501275e+04, 7.5001250e+04, 7.5501225e+04,
       7.6001200e+04, 7.6501175e+04, 7.7001150e+04, 7.7501125e+04,
       7.8001100e+04, 7.8501075e+04, 7.9001050e+04, 7.9501025e+04,
       8.0001000e+04, 8.0500975e+04, 8.1000950e+04, 8.1500925e+04,
       8.2000900e+04, 8.2500875e+04, 8.3000850e+04, 8.3500825e+04,
       8.4000800e+04, 8.4500775e+04, 8.5000750e+04, 8.5500725e+04,
       8.6000700e+04, 8.6500675e+04, 8.7000650e+04, 8.7500625e+04,
       8.8000600e+04, 8.8500575e+04, 8.9000550e+04, 8.9500525e+04,
       9.0000500e+04, 9.0500475e+04, 9.1000450e+04, 9.1500425e+04,
       9.2000400e+04, 9.2500375e+04, 9.3000350e+04, 9.3500325e+04,
       9.4000300e+04, 9.4500275e+04, 9.5000250e+04, 9.5500225e+04,
       9.6000200e+04, 9.6500175e+04, 9.7000150e+04, 9.7500125e+04,
       9.8000100e+04, 9.8500075e+04, 9.9000050e+04, 9.9500025e+04,
       1.0000000e+05])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>wavelength</span></div><div class='sc-var-dims'>(wavelength [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.001, 0.067, ..., 13.162, 13.228</div></span></div><input id='attrs-e40a5db9-fa96-4a06-afb7-bb9bac3e5c6a' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-e40a5db9-fa96-4a06-afb7-bb9bac3e5c6a' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-09b5efbd-4a2c-4092-996f-935f658fc52a' class='sc-var-data-in' type='checkbox'><label for='data-09b5efbd-4a2c-4092-996f-935f658fc52a' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([6.61410746e-04, 6.67991783e-02, 1.32936946e-01, 1.99074714e-01,
       2.65212481e-01, 3.31350249e-01, 3.97488016e-01, 4.63625784e-01,
       5.29763551e-01, 5.95901319e-01, 6.62039087e-01, 7.28176854e-01,
       7.94314622e-01, 8.60452389e-01, 9.26590157e-01, 9.92727925e-01,
       1.05886569e+00, 1.12500346e+00, 1.19114123e+00, 1.25727899e+00,
       1.32341676e+00, 1.38955453e+00, 1.45569230e+00, 1.52183007e+00,
       1.58796783e+00, 1.65410560e+00, 1.72024337e+00, 1.78638114e+00,
       1.85251890e+00, 1.91865667e+00, 1.98479444e+00, 2.05093221e+00,
       2.11706997e+00, 2.18320774e+00, 2.24934551e+00, 2.31548328e+00,
       2.38162104e+00, 2.44775881e+00, 2.51389658e+00, 2.58003435e+00,
       2.64617211e+00, 2.71230988e+00, 2.77844765e+00, 2.84458542e+00,
       2.91072318e+00, 2.97686095e+00, 3.04299872e+00, 3.10913649e+00,
       3.17527426e+00, 3.24141202e+00, 3.30754979e+00, 3.37368756e+00,
       3.43982533e+00, 3.50596309e+00, 3.57210086e+00, 3.63823863e+00,
       3.70437640e+00, 3.77051416e+00, 3.83665193e+00, 3.90278970e+00,
       3.96892747e+00, 4.03506523e+00, 4.10120300e+00, 4.16734077e+00,
       4.23347854e+00, 4.29961630e+00, 4.36575407e+00, 4.43189184e+00,
       4.49802961e+00, 4.56416737e+00, 4.63030514e+00, 4.69644291e+00,
       4.76258068e+00, 4.82871844e+00, 4.89485621e+00, 4.96099398e+00,
       5.02713175e+00, 5.09326952e+00, 5.15940728e+00, 5.22554505e+00,
       5.29168282e+00, 5.35782059e+00, 5.42395835e+00, 5.49009612e+00,
       5.55623389e+00, 5.62237166e+00, 5.68850942e+00, 5.75464719e+00,
       5.82078496e+00, 5.88692273e+00, 5.95306049e+00, 6.01919826e+00,
       6.08533603e+00, 6.15147380e+00, 6.21761156e+00, 6.28374933e+00,
       6.34988710e+00, 6.41602487e+00, 6.48216263e+00, 6.54830040e+00,
       6.61443817e+00, 6.68057594e+00, 6.74671370e+00, 6.81285147e+00,
       6.87898924e+00, 6.94512701e+00, 7.01126478e+00, 7.07740254e+00,
       7.14354031e+00, 7.20967808e+00, 7.27581585e+00, 7.34195361e+00,
       7.40809138e+00, 7.47422915e+00, 7.54036692e+00, 7.60650468e+00,
       7.67264245e+00, 7.73878022e+00, 7.80491799e+00, 7.87105575e+00,
       7.93719352e+00, 8.00333129e+00, 8.06946906e+00, 8.13560682e+00,
       8.20174459e+00, 8.26788236e+00, 8.33402013e+00, 8.40015789e+00,
       8.46629566e+00, 8.53243343e+00, 8.59857120e+00, 8.66470896e+00,
       8.73084673e+00, 8.79698450e+00, 8.86312227e+00, 8.92926004e+00,
       8.99539780e+00, 9.06153557e+00, 9.12767334e+00, 9.19381111e+00,
       9.25994887e+00, 9.32608664e+00, 9.39222441e+00, 9.45836218e+00,
       9.52449994e+00, 9.59063771e+00, 9.65677548e+00, 9.72291325e+00,
       9.78905101e+00, 9.85518878e+00, 9.92132655e+00, 9.98746432e+00,
       1.00536021e+01, 1.01197399e+01, 1.01858776e+01, 1.02520154e+01,
       1.03181532e+01, 1.03842909e+01, 1.04504287e+01, 1.05165665e+01,
       1.05827042e+01, 1.06488420e+01, 1.07149798e+01, 1.07811175e+01,
       1.08472553e+01, 1.09133931e+01, 1.09795308e+01, 1.10456686e+01,
       1.11118064e+01, 1.11779441e+01, 1.12440819e+01, 1.13102197e+01,
       1.13763574e+01, 1.14424952e+01, 1.15086330e+01, 1.15747707e+01,
       1.16409085e+01, 1.17070463e+01, 1.17731840e+01, 1.18393218e+01,
       1.19054596e+01, 1.19715973e+01, 1.20377351e+01, 1.21038729e+01,
       1.21700106e+01, 1.22361484e+01, 1.23022862e+01, 1.23684239e+01,
       1.24345617e+01, 1.25006995e+01, 1.25668373e+01, 1.26329750e+01,
       1.26991128e+01, 1.27652506e+01, 1.28313883e+01, 1.28975261e+01,
       1.29636639e+01, 1.30298016e+01, 1.30959394e+01, 1.31620772e+01,
       1.32282149e+01])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-9a5c0b99-39c2-4376-8aea-0ccd17e3cbdf' class='sc-section-summary-in' type='checkbox'  checked><label for='section-9a5c0b99-39c2-4376-8aea-0ccd17e3cbdf' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(spectrum, wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>0.0, 0.0, ..., 0.0, 0.0</div></span><span><div>σ = 0.0, 0.0, ..., 0.0, 0.0</div></span></div><input id='attrs-e8749d4b-7d95-436a-b1b4-b63f6ae92dd2' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-e8749d4b-7d95-436a-b1b4-b63f6ae92dd2' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7af4d00b-cd37-4905-bd16-f77fa64b678e' class='sc-var-data-in' type='checkbox'><label for='data-7af4d00b-cd37-4905-bd16-f77fa64b678e' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]])<br><br>Variances (σ²):<br>array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]])</pre></li></ul></div></li></ul></div></div></div>
</div>
</section>
<section id="Diffraction-calibration">
<h3>Diffraction calibration<a class="headerlink" href="#Diffraction-calibration" title="Link to this heading">#</a></h3>
<p>While the built-in conversion graphs support computation of <span class="math notranslate nohighlight">\(d\)</span>-spacing based on beamline component positions and time-of-flight, in practice it frequently is computed based parameters from a calibration file. We define a function <code class="docutils literal notranslate"><span class="pre">dspacing</span></code> to compute this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>


<span class="k">def</span><span class="w"> </span><span class="nf">dspacing</span><span class="p">(</span><span class="n">tof</span><span class="p">,</span> <span class="n">tzero</span><span class="p">,</span> <span class="n">difc</span><span class="p">):</span>
    <span class="n">difc</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">difc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">difc</span> <span class="o">*</span> <span class="p">(</span><span class="n">tof</span> <span class="o">-</span> <span class="n">tzero</span><span class="p">)</span>


<span class="n">calibration_graph</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dspacing&quot;</span><span class="p">:</span> <span class="n">dspacing</span><span class="p">}</span>
<span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">calibration_graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_33_0.svg" src="../_images/user-guide_coordinate-transformations_33_0.svg" />
</div>
</div>
<p>We can then load powder data and set the required input coordinates from a corresponding calibration file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scippneutron</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">scn</span>

<span class="n">da</span> <span class="o">=</span> <span class="n">scn</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">powder_sample</span><span class="p">()[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">calibration</span> <span class="o">=</span> <span class="n">scn</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">powder_calibration</span><span class="p">()</span>
<span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;tzero&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;tzero&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;difc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;difc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Load-[Notice] Load started
Load-[Notice] Load successful, Duration 1.81 seconds
DeleteWorkspace-[Notice] DeleteWorkspace started
DeleteWorkspace-[Notice] DeleteWorkspace successful, Duration 0.00 seconds
</pre></div></div>
</div>
<p>The coordinate transformation then yields:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;dspacing&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">calibration_graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (548.89 MB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-ccb355eb-7edb-41af-bae1-ff9fec5618fd' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-ccb355eb-7edb-41af-bae1-ff9fec5618fd' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>spectrum</span>: 24794</li><li><span class='sc-has-index'>dspacing</span>: 1</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-1200eba8-be1c-469a-a508-f21321fa5567' class='sc-section-summary-in' type='checkbox'  checked><label for='section-1200eba8-be1c-469a-a508-f21321fa5567' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(8)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>difc</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>10N/mW</div><div class='sc-value-preview sc-preview'><span><div>2.997e+04, 3.003e+04, ..., 7113.696, 7125.408</div></span></div><input id='attrs-6896c865-8812-4299-bb10-fb2fe25e2173' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6896c865-8812-4299-bb10-fb2fe25e2173' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d0623de9-cfcc-4ab0-ae7d-4c5a90f0058b' class='sc-var-data-in' type='checkbox'><label for='data-d0623de9-cfcc-4ab0-ae7d-4c5a90f0058b' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([29971.33683513, 30030.72117038, 30087.70542759, ...,
        7107.51320735,  7113.6962062 ,  7125.40789494])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>dspacing</span></div><div class='sc-var-dims'>(dspacing [bin-edge], spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.001, 0.001, ..., 2.347, 2.343</div></span></div><input id='attrs-6299a7a3-e48d-46fc-9a39-2c21ac9c122f' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6299a7a3-e48d-46fc-9a39-2c21ac9c122f' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6a309908-5b3d-40d5-abd1-8266ed92fbef' class='sc-var-data-in' type='checkbox'><label for='data-6a309908-5b3d-40d5-abd1-8266ed92fbef' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[6.67304235e-04, 6.65984672e-04, 6.64723339e-04, ...,
        2.81392372e-03, 2.81147795e-03, 2.80685686e-03],
       [5.57008881e-01, 5.55907422e-01, 5.54854567e-01, ...,
        2.34882445e+00, 2.34678292e+00, 2.34292563e+00]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>position</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 1.17451004 -1.01106149 -2.03796699], [ 1.18147634 -0.95946649 -2.05334117], ..., [1.81428985 0.09565841 3.84338287], [1.81375055 0.1499371  3.84269584]</div></span></div><input id='attrs-6c5bb41c-5fbb-4a5f-95a7-f0785ee59478' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6c5bb41c-5fbb-4a5f-95a7-f0785ee59478' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-119d46f5-3c14-4197-8334-b998f062e76c' class='sc-var-data-in' type='checkbox'><label for='data-119d46f5-3c14-4197-8334-b998f062e76c' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 1.17451004, -1.01106149, -2.03796699],
       [ 1.18147634, -0.95946649, -2.05334117],
       [ 1.18844265, -0.90787149, -2.06871534],
       ...,
       [ 1.81482915,  0.04137972,  3.8440699 ],
       [ 1.81428985,  0.09565841,  3.84338287],
       [ 1.81375055,  0.1499371 ,  3.84269584]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-67dfe5d6-e21a-4b99-9122-99e0b93f873d' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-67dfe5d6-e21a-4b99-9122-99e0b93f873d' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0d762349-2a22-4dff-b73d-7f20892a0526' class='sc-var-data-in' type='checkbox'><label for='data-0d762349-2a22-4dff-b73d-7f20892a0526' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[  0.   0. -60.]</div></span></div><input id='attrs-4e05a37d-67d0-4255-b2f0-f7920742dca3' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4e05a37d-67d0-4255-b2f0-f7920742dca3' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ea3d6a9b-7bed-4ab2-b802-4a5f458d60fa' class='sc-var-data-in' type='checkbox'><label for='data-ea3d6a9b-7bed-4ab2-b802-4a5f458d60fa' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  0.,   0., -60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>spectrum</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>int32</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>1, 2, ..., 24793, 24794</div></span></div><input id='attrs-1b5b1eb9-13b3-440e-909e-620a18b820ab' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1b5b1eb9-13b3-440e-909e-620a18b820ab' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-80424b75-2ba4-4720-bbdd-423b1a2ffe90' class='sc-var-data-in' type='checkbox'><label for='data-80424b75-2ba4-4720-bbdd-423b1a2ffe90' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([    1,     2,     3, ..., 24792, 24793, 24794], dtype=int32)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(dspacing [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>20.0, 1.669e+04</div></span></div><input id='attrs-ad3ab9f1-889e-481e-a0d2-335eec466e90' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-ad3ab9f1-889e-481e-a0d2-335eec466e90' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ae5245bb-f275-4246-bdaa-98c2ce36e61c' class='sc-var-data-in' type='checkbox'><label for='data-ae5245bb-f275-4246-bdaa-98c2ce36e61c' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([   20.        , 16694.30078125])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tzero</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>0.0, 0.0, ..., 0.0, 0.0</div></span></div><input id='attrs-bdb46ccc-d15b-4992-bc2f-107b7575667b' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-bdb46ccc-d15b-4992-bc2f-107b7575667b' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a4520aaa-3f27-427b-ac4b-83c8db706071' class='sc-var-data-in' type='checkbox'><label for='data-a4520aaa-3f27-427b-ac4b-83c8db706071' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0., ..., 0., 0., 0.])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-14cdd31b-5d93-4f5d-8cd2-f3cc7802ee73' class='sc-section-summary-in' type='checkbox'  checked><label for='section-14cdd31b-5d93-4f5d-8cd2-f3cc7802ee73' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(spectrum, dspacing)</div><div class='sc-var-dtype'>float32</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>binned data [len=0, len=0, ..., len=0, len=0]</div></span></div><input id='attrs-3d83484f-d59a-42e2-92e7-ac35c5ed5dd9' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3d83484f-d59a-42e2-92e7-ac35c5ed5dd9' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-865660d8-02e9-4108-992d-96c9739f2888' class='sc-var-data-in' type='checkbox'><label for='data-865660d8-02e9-4108-992d-96c9739f2888' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>dim=&#x27;event&#x27;,
content=DataArray(
          dims=(event: 17926980),
          data=float32[counts],
          coords={&#x27;tof&#x27;:float64[µs], &#x27;pulse_time&#x27;:datetime64[ns], &#x27;dspacing&#x27;:float64[Å]})</pre></li></ul></div></li></ul></div></div></div>
</div>
</section>
<section id="2-D-Rietveld">
<h3>2-D Rietveld<a class="headerlink" href="#2-D-Rietveld" title="Link to this heading">#</a></h3>
<p>Powder diffraction data is typically converted to <span class="math notranslate nohighlight">\(d\)</span>-spacing for Rietveld refinement. A more advanced approach additionally requires data depending on <span class="math notranslate nohighlight">\(d_{\perp}\)</span> for a <a class="reference external" href="https://journals.iucr.org/j/issues/2017/03/00/pd5090/index.html">2-D Rietveld refinement process</a>. We define</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">dspacing_perpendicular</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">two_theta</span><span class="p">):</span>
    <span class="n">lambda_K</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;angstrom&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">wavelength</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">lambda_K</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">two_theta</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<p>We then add this as a new node (new dict item) to a graph consisting of built-ins:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">graph</span>

<span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">graph</span><span class="o">.</span><span class="n">beamline</span><span class="o">.</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="o">**</span><span class="n">graph</span><span class="o">.</span><span class="n">tof</span><span class="o">.</span><span class="n">elastic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">)}</span>
<span class="n">graph</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dspacing&quot;</span>  <span class="c1"># rename to brief name</span>
<span class="n">graph</span><span class="p">[</span><span class="s2">&quot;d_perp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dspacing_perpendicular</span>
</pre></div>
</div>
</div>
<p>The result is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>

<span class="k">del</span> <span class="n">graph</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span>  <span class="c1"># not necessary, clarifies conversion graph</span>
<span class="k">del</span> <span class="n">graph</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span>  <span class="c1"># not necessary, clarifies conversion graph</span>
<span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_43_0.svg" src="../_images/user-guide_coordinate-transformations_43_0.svg" />
</div>
</div>
<p>We can then apply the transformation:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scippneutron</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">scn</span>

<span class="n">da</span> <span class="o">=</span> <span class="n">scn</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">powder_sample</span><span class="p">()[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">da_d_d_perp</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">([</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;d_perp&quot;</span><span class="p">],</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
<span class="n">da_d_d_perp</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Load-[Notice] Load started
Load-[Notice] Load successful, Duration 1.62 seconds
DeleteWorkspace-[Notice] DeleteWorkspace started
DeleteWorkspace-[Notice] DeleteWorkspace successful, Duration 0.00 seconds
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (961.10 MB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-3112cd48-7ffe-44d8-a56b-53218932550f' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-3112cd48-7ffe-44d8-a56b-53218932550f' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>spectrum</span>: 24794</li><li><span class='sc-has-index'>tof</span>: 1</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-27c7c9be-3c74-4010-aa39-07a899135097' class='sc-section-summary-in' type='checkbox'  checked><label for='section-27c7c9be-3c74-4010-aa39-07a899135097' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(15)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>L1</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>60.0</div></span></div><input id='attrs-07d4423f-4061-4b00-b0a4-67cc5526bbfd' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-07d4423f-4061-4b00-b0a4-67cc5526bbfd' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-96ece828-2427-4484-b4fb-4598c15ce6ff' class='sc-var-data-in' type='checkbox'><label for='data-96ece828-2427-4484-b4fb-4598c15ce6ff' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(60.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>L2</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>2.560, 2.556, ..., 4.251, 4.252</div></span></div><input id='attrs-9c8279b0-5c82-4052-b167-ba6f4eb1e810' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-9c8279b0-5c82-4052-b167-ba6f4eb1e810' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b1c98c94-b501-4da0-a0a1-08edb1a2fade' class='sc-var-data-in' type='checkbox'><label for='data-b1c98c94-b501-4da0-a0a1-08edb1a2fade' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([2.56027902, 2.55590928, 2.55268677, ..., 4.25113991, 4.25116338,
       4.25188   ])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>Ltotal</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>62.560, 62.556, ..., 64.251, 64.252</div></span></div><input id='attrs-e5e2766a-fd58-4d6d-a0c4-d38b0cb3286a' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-e5e2766a-fd58-4d6d-a0c4-d38b0cb3286a' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-54479e06-8faf-42e2-bb9c-3fc58a26b4b7' class='sc-var-data-in' type='checkbox'><label for='data-54479e06-8faf-42e2-bb9c-3fc58a26b4b7' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([62.56027902, 62.55590928, 62.55268677, ..., 64.25113991,
       64.25116338, 64.25188   ])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>d</span></div><div class='sc-var-dims'>(spectrum, tof [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.001, 0.557, ..., 0.003, 2.343</div></span></div><input id='attrs-1514a8b5-1a13-4c00-9fc4-a29c891006bd' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1514a8b5-1a13-4c00-9fc4-a29c891006bd' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-545d6d6d-da0d-4f73-8a10-c23fcde28359' class='sc-var-data-in' type='checkbox'><label for='data-545d6d6d-da0d-4f73-8a10-c23fcde28359' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[6.67304240e-04, 5.57008884e-01],
       [6.65984677e-04, 5.55907426e-01],
       [6.64723343e-04, 5.54854571e-01],
       ...,
       [2.81392374e-03, 2.34882446e+00],
       [2.81147797e-03, 2.34678294e+00],
       [2.80685687e-03, 2.34292565e+00]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>d_perp</span></div><div class='sc-var-dims'>(spectrum, tof [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>1.511, 1.843, ..., 0.222, 1.052</div></span></div><input id='attrs-e836e18f-afbc-43fd-b815-375d544793af' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-e836e18f-afbc-43fd-b815-375d544793af' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1bf18f12-470b-4c15-8c9d-675aa13f0f3d' class='sc-var-data-in' type='checkbox'><label for='data-1bf18f12-470b-4c15-8c9d-675aa13f0f3d' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[1.51087893, 1.84314944],
       [1.52301705, 1.85315443],
       [1.53493473, 1.86299218],
       ...,
       [0.22150249, 1.0514863 ],
       [0.2216999 , 1.05152754],
       [0.22207149, 1.05159474]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>dspacing</span></div><div class='sc-var-dims'>(spectrum, tof [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.001, 0.557, ..., 0.003, 2.343</div></span></div><input id='attrs-7adabef5-2503-4a84-8644-44c252fd295b' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-7adabef5-2503-4a84-8644-44c252fd295b' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fef11f52-24ed-4c39-849d-4d7708ae0a8c' class='sc-var-data-in' type='checkbox'><label for='data-fef11f52-24ed-4c39-849d-4d7708ae0a8c' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[6.67304240e-04, 5.57008884e-01],
       [6.65984677e-04, 5.55907426e-01],
       [6.64723343e-04, 5.54854571e-01],
       ...,
       [2.81392374e-03, 2.34882446e+00],
       [2.81147797e-03, 2.34678294e+00],
       [2.80685687e-03, 2.34292565e+00]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>incident_beam</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 0.  0. 60.]</div></span></div><input id='attrs-bbeebf21-e31a-4e59-9969-27fa72f1fbdf' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-bbeebf21-e31a-4e59-9969-27fa72f1fbdf' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5fbd89e6-495c-4faf-8e0c-d4b70aa0f215' class='sc-var-data-in' type='checkbox'><label for='data-5fbd89e6-495c-4faf-8e0c-d4b70aa0f215' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([ 0.,  0., 60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>position</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 1.17451004 -1.01106149 -2.03796699], [ 1.18147634 -0.95946649 -2.05334117], ..., [1.81428985 0.09565841 3.84338287], [1.81375055 0.1499371  3.84269584]</div></span></div><input id='attrs-9a96a8e0-9e28-4b62-a761-7f53c309d2c3' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-9a96a8e0-9e28-4b62-a761-7f53c309d2c3' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4cad83ac-34d9-4824-ba1a-a5386a20343a' class='sc-var-data-in' type='checkbox'><label for='data-4cad83ac-34d9-4824-ba1a-a5386a20343a' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 1.17451004, -1.01106149, -2.03796699],
       [ 1.18147634, -0.95946649, -2.05334117],
       [ 1.18844265, -0.90787149, -2.06871534],
       ...,
       [ 1.81482915,  0.04137972,  3.8440699 ],
       [ 1.81428985,  0.09565841,  3.84338287],
       [ 1.81375055,  0.1499371 ,  3.84269584]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-6e902b0d-2f4b-4bba-a8ea-6b53e2a679a3' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6e902b0d-2f4b-4bba-a8ea-6b53e2a679a3' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-450b42eb-b446-4160-931b-ee00a619081c' class='sc-var-data-in' type='checkbox'><label for='data-450b42eb-b446-4160-931b-ee00a619081c' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>scattered_beam</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[ 1.17451004 -1.01106149 -2.03796699], [ 1.18147634 -0.95946649 -2.05334117], ..., [1.81428985 0.09565841 3.84338287], [1.81375055 0.1499371  3.84269584]</div></span></div><input id='attrs-35d0a9a2-ab8b-4932-9c3e-31003a8936e3' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-35d0a9a2-ab8b-4932-9c3e-31003a8936e3' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f7978e6a-43de-4858-a6d2-5059e016a0e2' class='sc-var-data-in' type='checkbox'><label for='data-f7978e6a-43de-4858-a6d2-5059e016a0e2' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[ 1.17451004, -1.01106149, -2.03796699],
       [ 1.18147634, -0.95946649, -2.05334117],
       [ 1.18844265, -0.90787149, -2.06871534],
       ...,
       [ 1.81482915,  0.04137972,  3.8440699 ],
       [ 1.81428985,  0.09565841,  3.84338287],
       [ 1.81375055,  0.1499371 ,  3.84269584]])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[  0.   0. -60.]</div></span></div><input id='attrs-fa080d06-555e-4013-a0f5-c7dcbfc8f9f7' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-fa080d06-555e-4013-a0f5-c7dcbfc8f9f7' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f90c9175-c195-49e8-a647-1d09ea90f46f' class='sc-var-data-in' type='checkbox'><label for='data-f90c9175-c195-49e8-a647-1d09ea90f46f' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  0.,   0., -60.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>spectrum</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>int32</div><div class='sc-var-unit'></div><div class='sc-value-preview sc-preview'><span><div>1, 2, ..., 24793, 24794</div></span></div><input id='attrs-befb0931-88aa-4aa6-a20e-f49524cc4dcc' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-befb0931-88aa-4aa6-a20e-f49524cc4dcc' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-62f9e2e6-3f16-4498-8ee3-7e4064febf76' class='sc-var-data-in' type='checkbox'><label for='data-62f9e2e6-3f16-4498-8ee3-7e4064febf76' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([    1,     2,     3, ..., 24792, 24793, 24794], dtype=int32)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(tof [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>µs</div><div class='sc-value-preview sc-preview'><span><div>20.0, 1.669e+04</div></span></div><input id='attrs-7cb2e048-5a9e-4ff3-a017-2c300846e96d' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-7cb2e048-5a9e-4ff3-a017-2c300846e96d' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-154848e1-2025-4948-b53d-0aff568ce160' class='sc-var-data-in' type='checkbox'><label for='data-154848e1-2025-4948-b53d-0aff568ce160' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([   20.        , 16694.30078125])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>two_theta</span></div><div class='sc-var-dims'>(spectrum)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>rad</div><div class='sc-value-preview sc-preview'><span><div>2.491, 2.504, ..., 0.442, 0.442</div></span></div><input id='attrs-55de61cf-5938-4220-abaf-28f8f3e17fc7' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-55de61cf-5938-4220-abaf-28f8f3e17fc7' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cefc04e7-b9b6-41ca-aaa1-87ef58c45239' class='sc-var-data-in' type='checkbox'><label for='data-cefc04e7-b9b6-41ca-aaa1-87ef58c45239' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([2.49144445, 2.50372965, 2.51564288, ..., 0.44118918, 0.44157918,
       0.44231324])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>wavelength</span></div><div class='sc-var-dims'>(spectrum, tof [bin-edge])</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>0.001, 1.056, ..., 0.001, 1.028</div></span></div><input id='attrs-757b076e-2297-43f5-86a0-075cd618ee8f' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-757b076e-2297-43f5-86a0-075cd618ee8f' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-51897414-f67d-442c-aafc-27ce6d889ad0' class='sc-var-data-in' type='checkbox'><label for='data-51897414-f67d-442c-aafc-27ce6d889ad0' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.00126471, 1.05567339],
       [0.0012648 , 1.05574713],
       [0.00126486, 1.05580152],
       ...,
       [0.00123143, 1.02789183],
       [0.00123143, 1.02789145],
       [0.00123141, 1.02787999]])</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-1b9888c3-065c-4945-ba62-6ea56af01f96' class='sc-section-summary-in' type='checkbox'  checked><label for='section-1b9888c3-065c-4945-ba62-6ea56af01f96' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(spectrum, tof)</div><div class='sc-var-dtype'>float32</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>binned data [len=0, len=0, ..., len=0, len=0]</div></span></div><input id='attrs-456b0d6e-3bc5-481e-8690-9acb213d37f9' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-456b0d6e-3bc5-481e-8690-9acb213d37f9' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-86958dd3-1960-4534-8cc2-934be9c0229e' class='sc-var-data-in' type='checkbox'><label for='data-86958dd3-1960-4534-8cc2-934be9c0229e' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>dim=&#x27;event&#x27;,
content=DataArray(
          dims=(event: 17926980),
          data=float32[counts],
          coords={&#x27;tof&#x27;:float64[µs], &#x27;pulse_time&#x27;:datetime64[ns], &#x27;wavelength&#x27;:float64[Å],
                  &#x27;dspacing&#x27;:float64[Å], &#x27;d_perp&#x27;:float64[Å], &#x27;d&#x27;:float64[Å]})</pre></li></ul></div></li></ul></div></div></div>
</div>
<p>In this case the <code class="docutils literal notranslate"><span class="pre">tof</span></code> dimension has not been renamed/replaced, since there are <em>two</em> output coordinates that depend on it. We can bin this result into 2-D <span class="math notranslate nohighlight">\(d\)</span> and <span class="math notranslate nohighlight">\(d_{\perp}\)</span> bins and remove the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> and <code class="docutils literal notranslate"><span class="pre">tof</span></code> dimensions:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da_d_d_perp</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d_perp</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_coordinate-transformations_47_0.svg" src="../_images/user-guide_coordinate-transformations_47_0.svg" />
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="chopper/chopper-cascade.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chopper Cascades</p>
      </div>
    </a>
    <a class="right-next"
       href="groupby.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">GroupBy</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025 Scipp contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><!-- This will display the version of the docs -->
Current ScippNeutron version: 0.0.0 (<a href="https://github.com/scipp/scippneutron/releases">older versions</a>).</div>
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>